<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daaymn Report Verification</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee&family=Inter:wght@400;700&display=swap');

        :root {
            --background-color: #121212;
            --card-color: #1E1E1E;
            --text-color: #E0E0E0;
            --gradient-start: #FC00FF;
            --gradient-end: #00DBDE;
            --success-color: #28a745;
            --error-color: #dc3545;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        #verification-card {
            background-color: var(--card-color);
            border-radius: 15px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .daaymn-title {
            font-family: 'Bungee', cursive;
            font-size: 48px;
            background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        .status-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .success { color: var(--success-color); }
        .error { color: var(--error-color); }
        .loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--gradient-end);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 25px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        p {
            font-size: 18px;
            line-height: 1.6;
        }

        strong {
            font-weight: 700;
            font-size: 20px;
            color: #fff;
        }

        /* Hide all result views by default */
        .result-view {
            display: none;
        }
    </style>
</head>
<body>

    <div id="verification-card">
        <h1 class="daaymn-title">Daaymn</h1>

        <!-- Loading View -->
        <div id="loading-view" class="result-view">
            <div class="loading"></div>
            <p>Verifying report...</p>
        </div>

        <!-- Success View -->
        <div id="success-view" class="result-view">
            <div class="status-icon success">&#10004;</div>
            <p>
                This report is verified.<br>
                It belongs to <strong id="user-name"></strong> with a score of <strong id="user-score"></strong>/10.
            </p>
        </div>

        <!-- Error View -->
        <div id="error-view" class="result-view">
            <div class="status-icon error">&#10060;</div>
            <p id="error-message">This report ID is invalid or could not be found.</p>
        </div>

    </div>

    <script>
        // --- CONFIGURATION ---
        // IMPORTANT: Replace these with your actual Supabase URL and Anon Key.
        const SUPABASE_FUNCTION_URL = 'YOUR_SUPABASE_URL/functions/v1/verify-report';

        // --- SCRIPT LOGIC ---
        document.addEventListener('DOMContentLoaded', async () => {
            const loadingView = document.getElementById('loading-view');
            const successView = document.getElementById('success-view');
            const errorView = document.getElementById('error-view');
            const errorMessage = document.getElementById('error-message');

            const showView = (view) => {
                document.querySelectorAll('.result-view').forEach(v => v.style.display = 'none');
                view.style.display = 'block';
            };

            showView(loadingView);

            const params = new URLSearchParams(window.location.search);
            const reportId = params.get('id');

            if (!reportId) {
                errorMessage.textContent = 'No report ID was provided in the URL.';
                showView(errorView);
                return;
            }

            try {
                const response = await fetch(SUPABASE_FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: reportId }),
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('user-name').textContent = data.user_name;
                    document.getElementById('user-score').textContent = parseFloat(data.score).toFixed(1);
                    showView(successView);
                } else {
                    errorMessage.textContent = 'This report ID is invalid or could not be found.';
                    showView(errorView);
                }
            } catch (err) {
                console.error('Verification failed:', err);
                errorMessage.textContent = 'An error occurred while trying to verify the report. Please try again later.';
                showView(errorView);
            }
        });
    </script>

</body>
</html>
