    <script>
        // *** THIS IS THE FINAL, CORRECTED SCRIPT ***
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const scannerContainer = document.getElementById('scanner-container');
        const statusText = document.getElementById('status-text');
        const progressBar = document.getElementById('progress-bar');
        const resultContainer = document.getElementById('result-container');
        const resultText = document.getElementById('result-text');

        // IMPORTANT: You MUST replace this with your real Supabase function URL
        const SUPABASE_VERIFY_URL = 'YOUR_SUPABASE_URL/functions/v1/verify-report';

        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag-over'); handleFile(e.dataTransfer.files[0]); });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) {
                alert('Please upload a valid image file (PNG or JPEG).');
                return;
            }
            dropZone.style.display = 'none';
            resultContainer.style.display = 'none';
            scannerContainer.style.display = 'block';
            progressBar.style.width = '0%';
            statusText.textContent = 'Initializing scanner...';

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => simulateScanAndDecode(img);
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function simulateScanAndDecode(image) {
            statusText.textContent = 'Scanning for verification signature...';
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                progressBar.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    decodeQrCode(image);
                }
            }, 200);
        }

        function decodeQrCode(image) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = image.width;
            canvas.height = image.height;
            ctx.drawImage(image, 0, 0, image.width, image.height);
            const imageData = ctx.getImageData(0, 0, image.width, image.height);
            
            const code = jsQR(imageData.data, imageData.width, imageData.height);

            if (code && code.data) {
                // The QR code data is now just the UUID.
                checkSignatureWithBackend(code.data);
            } else {
                displayResult(false, "Verification Failed: No signature found in image.");
            }
        }
        
        async function checkSignatureWithBackend(uuid) {
            statusText.textContent = 'Verifying signature with Daaymn servers...';
            
            if (!uuid) {
                return displayResult(false, 'Verification Failed: Invalid signature format.');
            }

            try {
                // The fetch body is now just the UUID.
                const response = await fetch(SUPABASE_VERIFY_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: uuid }) // Send ONLY the UUID
                });

                if (!response.ok) {
                    return displayResult(false, 'Verification Failed: This report could not be found.');
                }

                const data = await response.json();
                const scoreFromDb = parseFloat(data.score).toFixed(1);
                
                // If found, display the data from the database. No comparison needed.
                const message = `Verified! Belongs to ${data.user_name} with score ${scoreFromDb}/10`;
                displayResult(true, message);

            } catch (error) {
                console.error("Backend verification error:", error);
                displayResult(false, 'An error occurred while connecting to Daaymn servers.');
            }
        }

        function displayResult(isVerified, message) {
            scannerContainer.style.display = 'none';
            resultContainer.style.display = 'block';
            resultText.textContent = message;
            resultText.className = isVerified ? 'verified' : 'failed';
        }
    </script>
